<h1>[Oficialia]</h1>
<form method="post" action="<?=($arr['inf'])?'index.php/Oficialia':'';?>" class="form-horizontal" ng-app="MyFirseModule" onload="bus()" enctype="multipart/form-data" ng-init="id=<?=$arr['inf']['id_depe']?>" id="form-ofi">
<div class="panel panel-primary sepa">
	<div class="panel-heading">Datos Generales</div>
	<div class="panel-body">
		<div class="form-group">
			<label class="col-sm-4 control-label">[dep]</label>
			<div class="col-sm-8">
                <article ng-controller="FirseController">
                    <select name="depen" class="form-control" ng-click="bus()" ng-model="id">
                        <?php foreach ($arr['dep'] as $key => $value):?>
                            <option value="<?= $value['id_depe']?>"<?=($value['id_depe'] == $arr['inf']['dep_ofi'])?'selected':'';?> ><?= $value['nombre_depe']?></option>
                        <?php endforeach;?>
                    </select>
                    <dl class="dl-horizontal">
                        <dt>[nombre]</dt>
                        <dd>{{todo[0].nombre_depe}}</dd>
                        <dt>[ubicacion]</dt>
                        <dd>{{todo[0].ubi_depe}}</dd>
                        <dt>[responsable]</dt>
                        <dd>{{todo[0].resp_depe}}</dd>
                        <dt>[contacto]</dt>
                        <dd>{{todo[0].conta_depe}}</dd>
                        <dt>[tel]</dt>
                        <dd>{{todo[0].tel_depe}}</dd>
                        <dt>[ext]</dt>
                        <dd>{{todo[0].ext_depe}}</dd>
                    </dl>
                </article>
            </div>
		</div>
		<div class="form-group">
            <label class="col-sm-4 control-label">No. de Oficio</label>
            <div class="col-sm-8">
            	<input type="text" class="form-control" name="numero" required value="<?=$arr['inf']['no_ofi']?>" id="numero">
            </div> 
		</div>
        <div class="form-group">
           <label class="col-sm-4 control-label">Seleccionar Archivo</label>
            <div class="col-sm-8">
                <?php if($arr['inf']){?>
                <input type="hidden" name="foto1" value="<?=$arr['inf']['foto_ofi']?>">
                <?php } ?>
                <input type="file" id="files" name="foto" accept=".pdf">
            </div> 
        </div>
	</div>
</div>
<div class="panel panel-primary sepa">
	<div class="panel-heading">Concepto</div>
	<div class="panel-body">
		<div class="form-group">
            <label class="col-sm-4 control-label">Concepto</label>
            <div class="col-sm-8">
                <select class="form-control" name="con" required id="cons">
                    <option value="0"></option>
                	<?php for($i=1;$i<8;$i++):?>
                	<option value="<?=$i?>" <?php echo ($arr['inf']['con_ofi'] == $i)?'selected':'';?>>[Con<?=$i?>]</option>
                	<?php endfor;?>
                </select>
            </div>
		</div>
        <div class="form-group" id="nomCon">
            <label class="col-sm-4 control-label">[nombre] del Concepto</label>
            <div class="col-sm-8">
                <input class="form-control" name="nom_con" value="<?=$arr['inf']['nomCon_ofi']?>" id="nombreCon">
            </div>
        </div>
        <div id="eventos" style="display:none;">
            <div class="form-group">
                <label class="col-sm-4 control-label">Nombre del Evento</label>
                <div class="col-sm-8">
                    <input class="form-control" name="nom_eve" value="" id="nombreEve">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">Fecha del Evento</label>
                <div class="col-sm-4">
                    <input class="form-control" name="fecha_eve" value="" id="fechaEve" readonly>
                </div>
            </div>
        </div>
		<div class="form-group">
            <label class="col-sm-4 control-label">[des]</label>
            <div class="col-sm-8">
                {op}
                <textarea id="desc" style="width:100;height:100px;" name="des" placeholder="Describa el concepto..." class="form-control"><?=$arr['inf']['des_ofi']?></textarea>
            </div>
		</div>
        <?php if(!$arr['inf']){?>
        <div class="form-group">
            <label class="col-sm-4 control-label" for="ser">[solSer]</label>
            <div clss="col-sm-8">
                <input type="checkbox" id="ser" name="ser" value="true" class="checkOfi">
            </div>
        </div>
        <div class="form-group invisible">
            <label class="col-sm-4 control-label">[tds]</label>
            <div class="col-sm-8">
                <select class="form-control" name="tser">
                    <option value="0"></option>
                    <?php for($i=1;$i<9;$i++):?>
                    <option value="<?=$i?>">[tSe<?=$i?>]</option>
                    <?php endfor;?>
                </select>
            </div>
        </div>
        <?php } ?>
	</div>
    <?php if(!$arr['inf']){?>
	<input type="hidden" name="fecha" value="<?=date('d/m/Y')?>">
    <input type="hidden" name="hora" value="<?=date('H:i')?>">
	<input type="hidden" name="usu" value="<?=$_SESSION['name_user']?>">
    <input type="hidden" name="idusu" value="<?=$_SESSION['id_user']?>">
    <?php }else{ ?>
    <input type="hidden" name="edit" value="<?=$arr['inf']['id_ofi']?>">
    <?php } ?>
</div>
<input type="hidden" name="url" value="<?=$_SERVER['PHP_SELF']?>">
<button class="btn btn-primary" type="submit">Enviar</button>
<?php if(!$arr['inf']){?><button class="btn btn-default" onclick="return oficios()">[new]</button><?php } ?>
</form>
<div id="msj" class="msj-save">
</div>
<script>
    $(function () {
        var numeros = <?=$arr['nums'];?>;
        console.log(numeros);
        $('#numero').blur(function () {
            var este = $(this)
            if(este.val())
            if(validarNumero(numeros,este.val()))
                este.val('').addClass('vacio').attr('placeholder','NÃºmero ya registrado')
        })
        $(document).on('focus click','#numero',function () {
            $(this).removeClass('vacio');
        })
        function validarNumero (lista,numero) {
            return in_array(numero,lista);
        }
        $('#ser').click(function () {
            var este = $(this);
            var abuelo = este.parent().parent()
            var tioAbuelo = abuelo.next()
            if(este.prop('checked') == true){
                tioAbuelo.removeClass('invisible');
            }else{
                tioAbuelo.addClass('invisible');
            }
        })
        $("#cons").change(function () {
            if($(this).val()==6) $('#eventos').show();
            else $('#eventos').hide();
        })
        $("#fechaEve").calendarioDW();
    })
</script>